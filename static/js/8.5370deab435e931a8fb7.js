webpackJsonp([8],{"6RQx":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"",""])},iAYX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,l=a("bOdI"),s=a.n(l),n=a("Dd8w"),o=a.n(n),r=a("ifoU"),c=a.n(r),d=a("uUlv"),p=a("Mukr"),u=new c.a([["未生效",{class:"blue"}],["生效中",{class:"green"}],["已失效",{class:"grey"}],["暂停",{class:"red"}]]),m=(i={name:"event",props:{projectId:{type:String,default:"1"}},computed:o()({},Object(d.b)(["user"])),components:{},data:function(){var e=this;return{query:{codeStatus:null,name:null,current:1,size:10,projectId:this.projectId},selectAllStatus:!1,selectList:[],statusOptions:[{value:"1",label:"未生效"},{value:"2",label:"生效中"},{value:"3",label:"已失效"},{value:"4",label:"暂停"}],Dialogwidth:"500px",tableList:{},pop:{dialogVisible:!1,popSteps:1,name:"",id:""},newRuleForm:{name:"",pageId:"",projectId:this.projectId},newRules:{name:[{required:!0,message:"请输入事件名称",trigger:"blur"},{validator:function(t,a,i){e.validateName(i)},trigger:"blur"}],pageId:[{required:!0,message:"请选择页面",trigger:"change"}]},pageListOptions:[],importRuleForm:{filename:""},importRules:{filename:[{required:!0,message:"请选择文件",trigger:"blur"}]},uploadAble:!0,file:null}}},s()(i,"computed",o()({},Object(d.b)(["user"]))),s()(i,"created",function(){this.getList(),this.getAllPage()}),s()(i,"methods",{getList:function(e){var t=this;this.query.current=e?this.query.current:1;var a=o()({},this.query);this.$api.event.pageQuery(a).then(function(i){0==i.code?(t.tableList=i.data,e&&!i.data.records.length&&a.current>1&&(a.current--,t.getList(!0)),e&&t.selectAllStatus&&t.$refs.table.toggleAllSelection()):t.$gidMessage(i.msg)})},getAllPage:function(){var e=this;this.$api.page.getAllPage().then(function(t){0==t.code?e.pageListOptions=t.data:e.$gidMessage(t.msg)})},selectAll:function(){this.selectAllStatus=!this.selectAllStatus,this.$refs.table.toggleAllSelection()},handleCurrentChange:function(e){this.query.current=Number(e),this.getList(!0)},handleSelectionChange:function(e){this.selectList=e.map(function(e){return e.id})},selectMap:function(e,t){return u.get(e)&&u.get(e)[t]||""},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"已失效"==t.ff?"color999":""},showDialog:function(e,t){this.Dialogwidth=3==e?"400px":"500px",this.pop.popSteps=e,this.pop.dialogVisible=!0,1==e?t?this.newRuleForm={name:t.name,pageId:t.pageId,projectId:this.projectId,id:t.id,isedit:!0}:(this.newRuleForm={name:"",pageId:null,projectId:this.projectId,isedit:!1},this.$refs.newRuleForm&&this.$refs.newRuleForm.resetFields()):2==e?this.importRuleForm.filename="":3!=e&&4!=e||!t||(this.pop.name=t.name,this.pop.id=t.id)},closeDialog:function(e){var t=this;this.$nextTick(function(){t.$refs[e].resetFields()}),this.pop.dialogVisible=!1},addEvent:function(){var e=this;this.$refs.newRuleForm.validate(function(t){if(!t)return!1;var a=o()({},e.newRuleForm);delete a.isedit,e.newRuleForm.isedit?e.$api.event.update(a).then(function(t){0==t.code?(e.$gidMessage("修改成功!",!0),e.getList(!0),e.closeDialog("newRuleForm")):e.$gidMessage(t.msg)}):(delete a.id,e.$api.event.add(a).then(function(t){0==t.code?(e.$gidMessage("新增成功!",!0),e.getList(),e.closeDialog("newRuleForm")):e.$gidMessage(t.msg)}))})},validateName:function(e){var t={name:this.newRuleForm.name,projectId:this.projectId};this.$api.event.existname(t).then(function(t){0==t.code&&(t.data?e(new Error("事件名重复")):e())})},del:function(e){var t=this,a={id:e};this.$api.event.delete(a).then(function(e){0==e.code?(t.getList(!0),t.pop.dialogVisible=!1,t.$gidMessage("删除成功",!0)):t.$gidMessage(e.msg)})},delHandle:function(e){var t=this,a={id:e.id};this.$api.page.canDelete(a).then(function(a){0==a.code?a.data?t.showDialog(4,e):t.showDialog(3,e):t.$gidMessage(a.msg)})},importProject:function(){var e=this;this.$refs.importRuleForm.validate(function(t){if(!t)return!1;var a=new FormData;e.uploadAble=!1,a.append("file",e.file),a.append("projectId",e.projectId),e.$api.event.batchImport(a).then(function(t){e.uploadAble=!0,"0"==t.code?(e.importRuleForm.filename=name,e.$gidMessage("导入成功",1),e.getList(),e.closeDialog("importRuleForm")):e.$gidMessage(t.msg||"导入失败")}).catch(function(t){e.$gidMessage("导入失败"),e.uploadAble=!0})})},showFileDialog:function(){this.$refs.uploadfile.value="",this.$refs.uploadfile.click()},uploadFile:function(e){if(e.target.files.length){var t=e.target.files[0],a=t.name,i=a.substring(a.lastIndexOf(".")+1);if("xls"!=i&&"xlsx"!=i)return void this.$gidMessage("请上传excel文件");this.file=t,this.importRuleForm.filename=a}},exportData:function(){if(this.selectAllStatus)Object(p.a)("/event/export","get",{projectId:this.projectId});else if(this.selectList.length){var e={ids:this.selectList,projectId:this.projectId};Object(p.a)("/event/export","get",e)}else this.$gidMessage("请选择要下载的项目数据")},exportTemplate:function(){Object(p.a)("/event/downloadTemplate","get",{})}}),i),g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:!e.uploadAble,expression:"!uploadAble",modifiers:{fullscreen:!0}}],staticClass:"main-page"},[a("div",{staticClass:"handle-bar"},[a("div",{staticClass:"fl list-select-down"},[a("el-select",{staticClass:"gcloud-select-down",attrs:{placeholder:"事件代码状态",clearable:""},on:{change:function(t){e.getList()}},model:{value:e.query.codeStatus,callback:function(t){e.$set(e.query,"codeStatus",t)},expression:"query.codeStatus"}},e._l(e.statusOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("div",{staticClass:"search-box fr"},[a("i",{staticClass:"btn-search",on:{click:function(t){e.getList()}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.query.name,expression:"query.name",modifiers:{trim:!0}}],staticClass:"search-input",attrs:{type:"text",placeholder:"请输入事件名称"},domProps:{value:e.query.name},on:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.getList()},input:function(t){t.target.composing||e.$set(e.query,"name",t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})])]),e._v(" "),a("div",{staticClass:"content-wrap"},[a("div",{staticClass:"table-hd"},[a("div",{staticClass:"table-hd-l"},[a("h4",[e._v("事件列表")]),e._v(" "),a("div",{staticClass:"btn-all",on:{click:e.selectAll}},[e._v("全选")])]),e._v(" "),a("div",{staticClass:"table-hd-r"},[a("div",{staticClass:"table-hd-btn new",on:{click:function(t){e.showDialog(1)}}},[e._v("新增事件")]),e._v(" "),a("div",{staticClass:"table-hd-btn import",on:{click:function(t){e.showDialog(2)}}},[e._v("批量导入")]),e._v(" "),a("div",{staticClass:"table-hd-btn down",on:{click:function(t){e.exportData()}}},[e._v("下载列表")])])]),e._v(" "),a("div",{staticClass:"gmop-table"},[a("el-table",{ref:"table",attrs:{data:e.tableList.records,border:"","row-class-name":e.tableRowClassName},on:{"selection-change":e.handleSelectionChange}},[e._v("\n                >\n                "),a("el-table-column",{attrs:{type:"selection",width:"38"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"事件ID","min-width":"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"pageName",label:"页面名称","min-width":"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{staticClass:"project-title"},[e._v(e._s(t.row.pageName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"事件名称","min-width":"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{staticClass:"project-title"},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"eventCode",label:"事件代码","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(decodeURIComponent(t.row.eventCode)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"事件代码状态","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("em",{staticClass:"icon-status",class:e.selectMap(t.row.codeStatus,"class")},[e._v(e._s(t.row.codeStatus))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"handle",on:{click:function(a){e.showDialog(1,t.row)}}},[e._v("修改")]),e._v(" "),a("span",{staticClass:"handle",on:{click:function(a){e.delHandle(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),e.tableList.total?a("div",{staticClass:"page-line"},[a("el-pagination",{staticClass:"page-box",attrs:{background:"","page-size":e.tableList.size,"prev-text":"上一页","next-text":"下一页",layout:"prev, pager, next,slot,jumper",total:e.tableList.total},on:{"current-change":e.handleCurrentChange}},[a("span",{staticClass:"page-info"},[e._v("共"+e._s(Math.ceil(e.tableList.total/e.tableList.size))+"页共"+e._s(e.tableList.total)+"条信息")])])],1):e._e()]),e._v(" "),a("el-dialog",{attrs:{title:"",visible:e.pop.dialogVisible,width:e.Dialogwidth,center:"",top:"30vh"},on:{"update:visible":function(t){e.$set(e.pop,"dialogVisible",t)}}},[1==e.pop.popSteps?[a("div",{staticClass:"list-wrap"},[a("p",{staticClass:"dialog-h",staticStyle:{"text-align":"center"}},[e.newRuleForm.isedit?[e._v("修改布码事件")]:[e._v("新增布码事件")]],2),e._v(" "),a("el-form",{ref:"newRuleForm",attrs:{model:e.newRuleForm,rules:e.newRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"事件名称：",prop:"name"}},[a("el-input",{attrs:{maxlength:"50",placeholder:"请输入事件名称"},model:{value:e.newRuleForm.name,callback:function(t){e.$set(e.newRuleForm,"name","string"==typeof t?t.trim():t)},expression:"newRuleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"页面列表：",prop:"pageId"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择页面",disabled:e.newRuleForm.isedit},model:{value:e.newRuleForm.pageId,callback:function(t){e.$set(e.newRuleForm,"pageId",t)},expression:"newRuleForm.pageId"}},e._l(e.pageListOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1),e._v(" "),a("div",{staticClass:"btn-line"},[a("div",{staticClass:"btn-center"},[a("em",{staticClass:"dialog-btn",on:{mousedown:function(t){e.addEvent()}}},[e._v("确定")]),e._v(" "),a("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.closeDialog("newRuleForm")}}},[e._v("取消")])])])],1)]:e._e(),e._v(" "),2==e.pop.popSteps?[a("div",{staticClass:"list-wrap"},[a("p",{staticClass:"dialog-h",staticStyle:{"text-align":"center"}},[e._v("事件批量导入")]),e._v(" "),a("el-form",{ref:"importRuleForm",attrs:{model:e.importRuleForm,rules:e.importRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择文件：",prop:"filename"}},[a("div",{staticClass:"file-wrap"},[a("a",{staticClass:"upload-btn",on:{click:function(t){e.showFileDialog()}}},[e._v(e._s(e.importRuleForm.filename?"重新选择":"选择文件"))]),e._v(" "),e.importRuleForm.filename?a("span",{staticClass:"file-name",attrs:{title:e.importRuleForm.filename}},[e._v(e._s(e.importRuleForm.filename))]):e._e(),e._v(" "),a("input",{ref:"uploadfile",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(t){e.uploadFile(t)}}})])]),e._v(" "),a("el-form-item",{attrs:{label:"参考模板：",prop:""}},[a("div",{staticClass:"a-link",on:{click:e.exportTemplate}},[e._v("下载事件批量导入模版.xlsx")])])],1),e._v(" "),a("div",{staticClass:"btn-line"},[a("div",{staticClass:"btn-center"},[a("em",{staticClass:"dialog-btn",on:{click:function(t){e.importProject()}}},[e._v("确定")]),e._v(" "),a("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.closeDialog("importRuleForm")}}},[e._v("取消")])])])],1)]:e._e(),e._v(" "),3==e.pop.popSteps?[a("div",{staticClass:"list-wrap"},[a("p",{staticClass:"dialog-p",staticStyle:{"text-align":"center"}},[e._v("\n                    是否确定删除事件 “\n                    "),a("span",{staticClass:"bold"},[e._v(e._s(e.pop.name))]),e._v("”？\n                ")]),e._v(" "),a("div",{staticClass:"btn-line"},[a("div",{staticClass:"btn-center"},[a("em",{staticClass:"dialog-btn",on:{click:function(t){e.del(e.pop.id)}}},[e._v("确定")]),e._v(" "),a("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.pop.dialogVisible=!1}}},[e._v("取消")])])])])]:e._e(),e._v(" "),4==e.pop.popSteps?[a("div",{staticClass:"list-wrap"},[a("p",{staticClass:"dialog-p",staticStyle:{"text-align":"center"}},[e._v("\n                    事件存在关联的漏斗,删除事件会导致事件下漏斗一同删除，请确定是否删除事件“\n                    "),a("span",{staticClass:"bold"},[e._v(e._s(e.pop.name))]),e._v("\n                    ” ？\n                ")]),e._v(" "),a("div",{staticClass:"btn-line"},[a("div",{staticClass:"btn-center"},[a("em",{staticClass:"dialog-btn",on:{click:function(t){e.del(e.pop.id)}}},[e._v("确定")]),e._v(" "),a("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.pop.dialogVisible=!1}}},[e._v("取消")])])])])]:e._e()],2)],1)},staticRenderFns:[]};var v=a("VU/8")(m,g,!1,function(e){a("qaxi")},"data-v-3b556a67",null);t.default=v.exports},qaxi:function(e,t,a){var i=a("6RQx");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("117a3bdd",i,!0,{})}});