webpackJsonp([7],{"7Xqg":function(e,t,i){var a=i("M6Qz");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("0f010536",a,!0,{})},M6Qz:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"",""])},SNtc:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Dd8w"),l=i.n(a),s=i("ifoU"),n=i.n(s),o=i("uUlv"),r=i("Mukr"),c=new n.a([["READY",{text:"未开始",class:"blue"}],["DOING",{text:"进行中",class:"green"}],["DONE",{text:"已结束",class:"grey"}]]),d={name:"list",components:{},data:function(){var e=this;return{query:{status:null,name:null,current:1,size:10},selectAllStatus:!1,selectList:[],statusOptions:[{value:"1",label:"未开始"},{value:"2",label:"进行中"},{value:"3",label:"已结束"}],Dialogwidth:"500px",tableList:{},pop:{dialogVisible:!1,popSteps:1,name:"",id:""},newRuleForm:{name:"",time:null,advertiserId:null,brandId:null,isedit:!1},newRules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{validator:function(t,i,a){e.validateName(a)},trigger:"blur"}],time:[{required:!0,message:"请选择项目时间",trigger:"change"}],advertiserId:[{required:!0,message:"请选择广告主",trigger:"change"}],brandId:[{required:!0,message:"请选择品牌",trigger:"change"}]},advOptions:[],brandOptions:[],pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},importRuleForm:{filename:""},importRules:{filename:[{required:!0,message:"请选择文件",trigger:"blur"}]},uploadAble:!0,file:null}},computed:l()({},Object(o.b)(["user"])),created:function(){this.getadverteiser(),this.brankQuery()},methods:{getList:function(e){var t=this;this.query.current=e?this.query.current:1;var i=l()({},this.query);delete i.name,this.$api.list.getList(i).then(function(a){0==a.code?(t.tableList=a.data,e&&!a.data.records.length&&i.current>1&&(i.current--,t.getList(!0)),e&&t.selectAllStatus&&t.$refs.table.toggleAllSelection()):t.$gidMessage(a.msg)})},brandName:function(e){var t=e;return this.brandOptions.map(function(i){i.id!=e||(t=i.name)}),t},getadverteiser:function(){var e=this;this.$api.list.adverteiserQuery().then(function(t){0==t.code?e.advOptions=t.data:e.$gidMessage(t.msg)})},brankQuery:function(){var e=this;this.$api.list.brankQuery().then(function(t){0==t.code?(e.brandOptions=t.data,e.getList()):e.$gidMessage(t.msg)})},selectAll:function(){this.selectAllStatus=!this.selectAllStatus,this.$refs.table.toggleAllSelection()},handleCurrentChange:function(e){this.query.current=Number(e),this.getList(!0)},handleSelectionChange:function(e){this.selectList=e.map(function(e){return e.id})},selectMap:function(e,t){return c.get(e)&&c.get(e)[t]||""},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"DONE"==t.status?"color999":""},showDialog:function(e,t){if(this.Dialogwidth=3==e?"400px":"500px",this.pop.popSteps=e,this.pop.dialogVisible=!0,1==e)if(t){var i=t.startTime,a=t.endTime;this.newRuleForm={brandId:t.brandId,isedit:!0,advertiserId:t.advertiserId,time:[i,a],id:t.id,name:t.name}}else this.newRuleForm={name:"",time:null,advertiserId:null,brandId:null,isedit:!1},this.$refs.newRuleForm&&this.$refs.newRuleForm.resetFields();else 2==e?this.importRuleForm.filename="":(3==e&&t||4==e&&t)&&(this.pop.name=t.name,this.pop.id=t.id)},closeDialog:function(e){var t=this;this.$nextTick(function(){t.$refs[e].resetFields()}),this.pop.dialogVisible=!1},openPath:function(e){window.open(e)},go:function(e,t){this.$router.push({path:e,query:t})},addProject:function(){var e=this;this.$refs.newRuleForm.validate(function(t){if(!t)return!1;var i=l()({},e.newRuleForm);i.startTime=e.newRuleForm.time?e.newRuleForm.time[0]:"",i.endTime=e.newRuleForm.time?e.newRuleForm.time[1]:"",delete i.time,delete i.isedit,e.newRuleForm.isedit?e.$api.list.update(i).then(function(t){0==t.code?(e.$gidMessage("修改成功!",!0),e.getList(!0),e.closeDialog("newRuleForm")):e.$gidMessage(t.msg)}):(delete i.id,e.$api.list.add(i).then(function(t){0==t.code?(e.$gidMessage("新增成功!",!0),e.getList(),e.closeDialog("newRuleForm")):e.$gidMessage(t.msg)}))})},validateName:function(e){var t={name:this.newRuleForm.name};this.$api.list.existname(t).then(function(t){0==t.code&&(t.data?e(new Error("项目名重复")):e())})},del:function(e){var t=this,i={id:e};this.$api.list.delete(i).then(function(e){0==e.code?(t.getList(!0),t.pop.dialogVisible=!1,t.$gidMessage("删除成功",!0)):t.$gidMessage(e.msg)})},delHandle:function(e){var t=this,i={id:e.id};this.$api.list.canDelete(i).then(function(i){0==i.code?"1:项目下无页面"==i.msg?t.showDialog(3,e):"2:项目下仅存有未生效的页面"==i.msg?t.showDialog(4,e):"3:项目下存在已生效或已失效的页面"==i.msg&&t.$gidMessage("项目“"+e.name+"”下页面已生效，无法删除"):t.$gidMessage(i.msg)})},importProject:function(){var e=this;this.$refs.importRuleForm.validate(function(t){if(!t)return!1;var i=new FormData;e.uploadAble=!1,i.append("file",e.file),e.$api.list.batchadd(i).then(function(t){e.uploadAble=!0,"0"==t.code?(e.importRuleForm.filename=name,e.$gidMessage("导入成功",1),e.getList(),e.closeDialog("importRuleForm")):e.$gidMessage(t.msg||"导入失败")}).catch(function(t){e.$gidMessage("导入失败"),e.uploadAble=!0})})},uploadFile:function(e){if(e.target.files.length){var t=e.target.files[0],i=t.name,a=i.substring(i.lastIndexOf(".")+1);if("xls"!=a&&"xlsx"!=a)return void this.$gidMessage("请上传excel文件");this.file=t,this.importRuleForm.filename=i}},showFileDialog:function(){this.$refs.uploadfile.value="",this.$refs.uploadfile.click()},exportData:function(){if(this.selectAllStatus)Object(r.a)("/project/exportAll","get",{});else if(this.selectList.length){var e={ids:this.selectList};Object(r.a)("/project/export","get",e)}else this.$gidMessage("请选择要下载的项目数据")},exportTemplate:function(){Object(r.a)("/project/downloadTemplate","get",{})}}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:!e.uploadAble,expression:"!uploadAble",modifiers:{fullscreen:!0}}],staticClass:"main-page list-page"},[i("div",{staticClass:"handle-bar"},[i("div",{staticClass:"fl list-select-down"},[i("el-select",{staticClass:"gcloud-select-down",attrs:{placeholder:"全部状态类型",clearable:""},on:{change:function(t){e.getList()}},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},e._l(e.statusOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("div",{staticClass:"search-box fr"},[i("i",{staticClass:"btn-search",on:{click:function(t){e.getList()}}}),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.query.name,expression:"query.name",modifiers:{trim:!0}}],staticClass:"search-input",attrs:{type:"text",placeholder:"请输入项目名称/品牌"},domProps:{value:e.query.name},on:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.getList()},input:function(t){t.target.composing||e.$set(e.query,"name",t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})])]),e._v(" "),i("div",{staticClass:"content-wrap"},[i("div",{staticClass:"table-hd"},[i("div",{staticClass:"table-hd-l"},[i("h4",[e._v("项目列表")]),e._v(" "),i("div",{staticClass:"btn-all",on:{click:e.selectAll}},[e._v("全选")])]),e._v(" "),i("div",{staticClass:"table-hd-r"},[i("div",{staticClass:"table-hd-btn new",on:{click:function(t){e.showDialog(1)}}},[e._v("新建项目")]),e._v(" "),i("div",{staticClass:"table-hd-btn import",on:{click:function(t){e.showDialog(2)}}},[e._v("批量导入")]),e._v(" "),i("div",{staticClass:"table-hd-btn down",on:{click:function(t){e.exportData()}}},[e._v("下载列表")])])]),e._v(" "),i("div",{staticClass:"gmop-table"},[i("el-table",{ref:"table",attrs:{data:e.tableList.records,border:"","row-class-name":e.tableRowClassName},on:{"selection-change":e.handleSelectionChange}},[e._v("\n                >\n                "),i("el-table-column",{attrs:{type:"selection",width:"38"}}),e._v(" "),i("el-table-column",{attrs:{prop:"id",label:"项目ID","min-width":"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"项目概况","min-width":"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"general-wrap"},[i("p",{staticClass:"project-title"},[e._v(e._s(t.row.name))]),e._v(" "),i("ul",[i("li",[e._v("\n                                    页面数：\n                                    "),i("em",[e._v(e._s(t.row.pageNum)+"个")])]),e._v(" "),i("li",[e._v("\n                                    事件数：\n                                    "),i("em",[e._v(e._s(t.row.eventNum)+"个")])]),e._v(" "),i("li",[e._v("\n                                    渠道数：\n                                    "),i("em",[e._v(e._s(t.row.channelNum)+"个")])]),e._v(" "),i("li",[e._v("\n                                    漏斗数：\n                                    "),i("em",[e._v(e._s(t.row.funnelNum)+"个")])])])])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"品牌","min-width":"100",prop:"brandId"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.brandName(t.row.brandId)))]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"项目时间","min-width":"125"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.startTime)+"-"+e._s(t.row.endTime))]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"status",label:"项目状态","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?i("em",{staticClass:"icon-status",class:e.selectMap(t.row.status,"class")},[e._v(e._s(e.selectMap(t.row.status,"text")))]):e._e()]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"handle handle-high",on:{click:function(t){e.openPath("http://www.baidu.com")}}},[e._v("查看统计")]),e._v(" "),i("span",{staticClass:"handle",on:{click:function(i){e.go("/page",{id:t.row.id})}}},[e._v("设置")]),e._v(" "),i("span",{staticClass:"handle",on:{click:function(i){e.showDialog(1,t.row)}}},[e._v("修改")]),e._v(" "),i("span",{staticClass:"handle",on:{click:function(i){e.delHandle(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),e.tableList.total?i("div",{staticClass:"page-line"},[i("el-pagination",{staticClass:"page-box",attrs:{background:"","page-size":e.tableList.size,"prev-text":"上一页","next-text":"下一页",layout:"prev, pager, next,slot,jumper",total:e.tableList.total},on:{"current-change":e.handleCurrentChange}},[i("span",{staticClass:"page-info"},[e._v("共"+e._s(Math.ceil(e.tableList.total/e.tableList.size))+"页共"+e._s(e.tableList.total)+"条信息")])])],1):e._e()]),e._v(" "),i("el-dialog",{attrs:{title:"",visible:e.pop.dialogVisible,width:e.Dialogwidth,center:"",top:"30vh"},on:{"update:visible":function(t){e.$set(e.pop,"dialogVisible",t)}}},[1==e.pop.popSteps?[i("div",{staticClass:"list-wrap"},[i("p",{staticClass:"dialog-h",staticStyle:{"text-align":"center"}},[e.newRuleForm.isedit?[e._v("修改项目")]:[e._v("新建项目")]],2),e._v(" "),i("el-form",{ref:"newRuleForm",attrs:{model:e.newRuleForm,rules:e.newRules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"项目名称：",prop:"name"}},[i("el-input",{attrs:{maxlength:"50",placeholder:"请输入项目名称"},model:{value:e.newRuleForm.name,callback:function(t){e.$set(e.newRuleForm,"name","string"==typeof t?t.trim():t)},expression:"newRuleForm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"项目时间：",prop:"time"}},[i("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions,format:"yyyy/MM/dd","value-format":"yyyy-MM-dd",disabled:e.newRuleForm.isedit},model:{value:e.newRuleForm.time,callback:function(t){e.$set(e.newRuleForm,"time",t)},expression:"newRuleForm.time"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"广告主：",prop:"advertiserId"}},[i("el-select",{attrs:{filterable:"",placeholder:"请选择广告主",disabled:e.newRuleForm.isedit},model:{value:e.newRuleForm.advertiserId,callback:function(t){e.$set(e.newRuleForm,"advertiserId",t)},expression:"newRuleForm.advertiserId"}},e._l(e.advOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.name+"("+e.id+")",value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"品牌：",prop:"brandId"}},[i("el-select",{attrs:{filterable:"",placeholder:"请选择品牌"},model:{value:e.newRuleForm.brandId,callback:function(t){e.$set(e.newRuleForm,"brandId",t)},expression:"newRuleForm.brandId"}},e._l(e.brandOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.name+"("+e.id+")",value:e.id}})}))],1)],1),e._v(" "),i("div",{staticClass:"btn-line"},[i("div",{staticClass:"btn-center"},[i("em",{staticClass:"dialog-btn",on:{mousedown:function(t){e.addProject()}}},[e._v("确定")]),e._v(" "),i("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.closeDialog("newRuleForm")}}},[e._v("取消")])])])],1)]:e._e(),e._v(" "),2==e.pop.popSteps?[i("div",{staticClass:"list-wrap"},[i("p",{staticClass:"dialog-h",staticStyle:{"text-align":"center"}},[e._v("项目批量导入")]),e._v(" "),i("el-form",{ref:"importRuleForm",attrs:{model:e.importRuleForm,rules:e.importRules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"选择文件：",prop:"filename"}},[i("div",{staticClass:"file-wrap"},[i("a",{staticClass:"upload-btn",on:{click:function(t){e.showFileDialog()}}},[e._v(e._s(e.importRuleForm.filename?"重新选择":"选择文件"))]),e._v(" "),e.importRuleForm.filename?i("span",{staticClass:"file-name",attrs:{title:e.importRuleForm.filename}},[e._v(e._s(e.importRuleForm.filename))]):e._e(),e._v(" "),i("input",{ref:"uploadfile",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(t){e.uploadFile(t)}}})])]),e._v(" "),i("el-form-item",{attrs:{label:"参考模板：",prop:""}},[i("div",{staticClass:"a-link",on:{click:e.exportTemplate}},[e._v("下载项目批量导入模版.xlsx")])])],1),e._v(" "),i("div",{staticClass:"btn-line"},[i("div",{staticClass:"btn-center"},[i("em",{staticClass:"dialog-btn",on:{click:function(t){e.importProject()}}},[e._v("确定")]),e._v(" "),i("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.closeDialog("importRuleForm")}}},[e._v("取消")])])])],1)]:e._e(),e._v(" "),3==e.pop.popSteps?[i("div",{staticClass:"list-wrap"},[i("p",{staticClass:"dialog-p",staticStyle:{"text-align":"center"}},[e._v("\n                    是否确定删除项目 “\n                    "),i("span",{staticClass:"bold"},[e._v(e._s(e.pop.name))]),e._v("”？\n                ")]),e._v(" "),i("div",{staticClass:"btn-line"},[i("div",{staticClass:"btn-center"},[i("em",{staticClass:"dialog-btn",on:{click:function(t){e.del(e.pop.id)}}},[e._v("确定")]),e._v(" "),i("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.pop.dialogVisible=!1}}},[e._v("取消")])])])])]:e._e(),e._v(" "),4==e.pop.popSteps?[i("div",{staticClass:"list-wrap"},[i("p",{staticClass:"dialog-p",staticStyle:{"text-align":"center"}},[e._v("\n                    项目存在未生效的页面，删除项目会导致项目下页面一同删除，请确定是否删除项目“\n                    "),i("span",{staticClass:"bold"},[e._v(e._s(e.pop.name))]),e._v("\n                    ” ？\n                ")]),e._v(" "),i("div",{staticClass:"btn-line"},[i("div",{staticClass:"btn-center"},[i("em",{staticClass:"dialog-btn",on:{click:function(t){e.del(e.pop.id)}}},[e._v("确定")]),e._v(" "),i("em",{staticClass:"dialog-btn cancel",on:{click:function(t){e.pop.dialogVisible=!1}}},[e._v("取消")])])])])]:e._e()],2)],1)},staticRenderFns:[]};var p=i("VU/8")(d,u,!1,function(e){i("7Xqg")},"data-v-3e5bd356",null);t.default=p.exports}});